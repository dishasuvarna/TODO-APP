<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Todo App</title>
  <style>
    body {
      background: linear-gradient(135deg, #eef2f7, #dfe6ed);
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .container {
      width: 500px;
      background: #fff;
      padding: 30px;
      border-radius: 18px;
      box-shadow: 0 12px 32px rgba(0,0,0,0.15);
      text-align: center;
      animation: popIn 0.8s cubic-bezier(0.25, 1, 0.5, 1);
    }

    h1 {
      color: #222;
      margin-bottom: 20px;
      font-size: 30px;
      letter-spacing: 1px;
      font-weight: 700;
      background: linear-gradient(90deg, #007bff, #00c6ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: fadeIn 1.2s ease-in-out;
    }

    input, button, select {
      padding: 10px 14px;
      margin: 5px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    input {
      min-width: 200px;
      max-width: 100%;
      box-sizing: border-box;
      background-color: #f9fafb;
    }

    input:focus {
      border-color: #007bff;
      outline: none;
      box-shadow: 0 0 10px rgba(0,123,255,0.5);
      transform: scale(1.02);
    }

    button {
      cursor: pointer;
      background-color: #f1f3f5;
      transition: transform 0.25s ease, background-color 0.3s ease;
    }

    button:hover {
      background-color: #007bff;
      color: white;
      transform: translateY(-3px) scale(1.08);
    }

    ul {
      list-style-type: none;
      padding: 0;
      margin-top: 20px;
    }

    li {
      margin: 10px 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f8f9fa;
      padding: 12px 16px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      opacity: 0;
      transform: translateY(20px);
      animation: fadeSlideIn 0.7s forwards ease-out;
    }

    li input[type="checkbox"] {
      margin-right: 10px;
      transform: scale(1.2);
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    li input[type="checkbox"]:hover {
      transform: scale(1.4);
    }

    .task-text {
      flex: 1;
      margin: 0 10px;
      transition: color 0.3s, text-decoration 0.3s;
      word-wrap: break-word;
      cursor: pointer;
    }

    .completed {
      text-decoration: line-through;
      color: #6c757d;
      animation: fadeOutComplete 0.6s ease forwards;
    }

    li:hover {
      transform: scale(1.05);
      transition: transform 0.25s ease;
    }

    .delete-btn {
      background-color: #ff4d4d;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      transition: background-color 0.3s, transform 0.2s;
    }

    .delete-btn:hover {
      background-color: #d00000;
      transform: scale(1.12) rotate(-2deg);
    }

    .clear-btn {
      display: block;
      margin: 20px auto 0;
      background-color: #6c757d;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 10px 16px;
      transition: background-color 0.3s, transform 0.2s;
    }

    .clear-btn:hover {
      background-color: #495057;
      transform: scale(1.08);
    }

    .counter {
      margin-top: 15px;
      font-size: 14px;
      color: #444;
      font-weight: 500;
      animation: fadeIn 1s ease-in;
    }

    .quote {
      margin-top: 20px;
      font-size: 15px;
      font-style: italic;
      color: #333;
      background: #f1f3f5;
      padding: 12px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      animation: fadeInUp 1.2s ease-out;
    }

    @keyframes fadeSlideIn {
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeOutComplete {
      from { opacity: 1; }
      to { opacity: 0.6; transform: scale(0.98); }
    }

    @keyframes popIn {
      from { transform: scale(0.85); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <!-- Structure unchanged -->
  <div class="container">
    <h1>My Todo List</h1>
    <div>
      <input id="taskInput" type="text" placeholder="Type a new task...">
      <button onclick="addTodo()">Add Task</button>
    </div>
    <div>
      <input id="searchInput" type="text" placeholder="Search tasks...">
    </div>
    <ul id="todoList"></ul>
    <button class="clear-btn" onclick="clearCompleted()">Clear Completed Tasks</button>
    <div class="counter" id="taskCounter">0 tasks total</div>
    <div class="quote" id="quoteBox"></div>
  </div>

  <script>
    const API_URL = 'http://localhost:3000/todos';

    async function fetchTodos() {
      try {
        const res = await fetch(API_URL);
        const todos = await res.json();
        renderTodos(todos);
      } catch (err) {
        console.error('Error fetching todos:', err);
      }
    }

    function renderTodos(todos) {
      const list = document.getElementById('todoList');
      list.innerHTML = '';
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      todos
        .filter(todo => todo.task.toLowerCase().includes(searchTerm))
        .forEach(todo => {
          const li = document.createElement('li');
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.checked = todo.completed || false;
          checkbox.onchange = async () => { await toggleComplete(todo); };

          const span = document.createElement('span');
          span.textContent = todo.task;
          span.className = 'task-text';
          if (todo.completed) span.classList.add('completed');
          span.ondblclick = () => enableEditing(span, todo);

          const delBtn = document.createElement('button');
          delBtn.textContent = 'Delete';
          delBtn.className = 'delete-btn';
          delBtn.onclick = () => deleteTodo(todo.id);

          li.appendChild(checkbox);
          li.appendChild(span);
          li.appendChild(delBtn);
          list.appendChild(li);
        });
      updateCounter(todos);
    }

    async function addTodo() {
      const input = document.getElementById('taskInput');
      const task = input.value.trim();
      if (!task) return;
      try {
        await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ task, completed: false })
        });
        input.value = '';
        input.focus();
        input.style.width = '200px';
        fetchTodos();
      } catch (err) {
        console.error('Error adding todo:', err);
      }
    }

    async function deleteTodo(id) {
      try {
        await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
        fetchTodos();
      } catch (err) {
                console.error('Error deleting todo:', err);
      }
    }

    async function toggleComplete(todo) {
      try {
        await fetch(`${API_URL}/${todo.id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ ...todo, completed: !todo.completed })
        });
        fetchTodos();
      } catch (err) {
        console.error('Error updating todo:', err);
      }
    }

    async function clearCompleted() {
      try {
        const res = await fetch(API_URL);
        const todos = await res.json();
        for (const todo of todos) {
          if (todo.completed) {
            await fetch(`${API_URL}/${todo.id}`, { method: 'DELETE' });
          }
        }
        fetchTodos();
      } catch (err) {
        console.error('Error clearing completed todos:', err);
      }
    }

    function updateCounter(todos) {
      const counter = document.getElementById('taskCounter');
      const total = todos.length;
      const completed = todos.filter(t => t.completed).length;
      counter.textContent = `${total} tasks total (${completed} completed)`;
    }

    function enableEditing(span, todo) {
      const input = document.createElement('input');
      input.type = 'text';
      input.value = todo.task;
      input.className = 'task-text';
      span.replaceWith(input);
      input.focus();

      const save = async () => {
        const newTask = input.value.trim();
        if (newTask && newTask !== todo.task) {
          await fetch(`${API_URL}/${todo.id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ ...todo, task: newTask })
          });
        }
        fetchTodos();
      };

      input.addEventListener('blur', save);
      input.addEventListener('keypress', e => {
        if (e.key === 'Enter') save();
      });
    }

    // Auto-resizing input for new tasks
    const taskInput = document.getElementById('taskInput');
    taskInput.addEventListener('input', () => {
      const length = taskInput.value.length;
      const newWidth = Math.min(200 + length * 8, taskInput.parentElement.offsetWidth - 80);
      taskInput.style.width = newWidth + 'px';
    });

    document.getElementById('taskInput').addEventListener('keypress', e => {
      if (e.key === 'Enter') addTodo();
    });

    // Live search filter
    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('input', fetchTodos);

    // Motivational Quotes Feature
    const quotes = [
      "Believe you can and you're halfway there.",
      "Small steps every day lead to big results.",
      "Your future is created by what you do today.",
      "Stay positive, work hard, make it happen.",
      "Don't watch the clock; do what it does. Keep going.",
      "Success is the sum of small efforts repeated daily."
    ];

    function showQuote() {
      const quoteBox = document.getElementById('quoteBox');
      const randomIndex = Math.floor(Math.random() * quotes.length);
      quoteBox.textContent = quotes[randomIndex];
    }

    // Initial fetch when page loads
    fetchTodos();
    showQuote();
  </script>
</body>
</html>
